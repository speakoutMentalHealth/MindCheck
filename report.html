<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SpeakOut Anonymous Report üíö</title>
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: #f5fdf8;
      color: #062436;
      text-align: center;
      padding: 0;
      margin: 0;
    }
    header {
      background: #22c55e;
      color: #fff;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    header img {
      height: 40px;
      width: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    form {
      background: #fff;
      max-width: 550px;
      margin: 20px auto;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 25px rgba(34,197,94,0.15);
      text-align: left;
    }
    h2 {
      text-align: center;
      color: #16a34a;
    }
    label {
      font-weight: 600;
      margin-top: 14px;
      display: block;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      font-size: 1rem;
    }
    textarea {
      resize: vertical;
    }
    button {
      display: block;
      width: 100%;
      background: #22c55e;
      color: white;
      border: none;
      padding: 14px;
      margin-top: 18px;
      border-radius: 12px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    button:hover {
      background: #16a34a;
    }
    .back-btn {
      background: #fff;
      color: #22c55e;
      border: 1px solid #22c55e;
    }
    .back-btn:hover {
      background: #f0fdf4;
    }
    small {
      color: #64748b;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>

  <header>
    <img src="https://speakoutmentalhealth.github.io/MindCheck/icons/apple-touch-icon.png" alt="SpeakOut Logo">
    <h1>SpeakOut MindCheck üíö</h1>
  </header>

  <form id="reportForm">
    <h2>Anonymous Reporting Form</h2>
    <p style="text-align:center;">If you or someone you know is in danger, please tell a trusted adult or call <b>112</b> immediately.</p>

    <label>Who is this about?</label>
    <select name="who" required>
      <option value="">-- choose one --</option>
      <option value="myself">Myself</option>
      <option value="friend">A friend</option>
      <option value="someone_else">Someone else</option>
    </select>

    <label>Type of concern</label>
    <select name="concernType" required>
      <option value="">-- choose one --</option>
      <option value="self_harm">I feel like hurting myself</option>
      <option value="being_hurt">Someone is hurting me (bullying, abuse, threats)</option>
      <option value="not_safe_home">I don‚Äôt feel safe at home</option>
      <option value="worried_for_friend">I‚Äôm worried about a friend</option>
      <option value="other">Something else</option>
    </select>

    <label>What happened? (please describe briefly)</label>
    <textarea name="details" rows="4" placeholder="Write what‚Äôs going on..." required></textarea>

    <label>Where are you (school / community)?</label>
    <input type="text" name="locationContext" placeholder="e.g. SpeakOut Secondary School, Lugbe" />

    <label>How old are you?</label>
    <select name="ageBand">
      <option value="">Prefer not to say</option>
      <option value="Under 13">Under 13</option>
      <option value="13-15">13‚Äì15</option>
      <option value="16-18">16‚Äì18</option>
      <option value="18+">18+</option>
    </select>

    <label>Do you want someone to contact you to help?</label>
    <select name="allowContact" required>
      <option value="">-- choose one --</option>
      <option value="yes">Yes, please reach me</option>
      <option value="no">No, keep me anonymous</option>
    </select>

    <label>How can we reach you safely? (optional)</label>
    <input type="text" name="contactInfo" placeholder="Phone or WhatsApp (optional)" />

    <label>Safe adult (optional)</label>
    <input type="text" name="safeAdult" placeholder="e.g. Mrs. Grace, Guidance Counselor, SS2 Block" />

    <small>
      By submitting, you agree we may share this information with a trusted adult or school contact if someone‚Äôs life or safety is in danger.
    </small>

    <button type="submit">Submit Report ‚úÖ</button>
    <button type="button" class="back-btn" onclick="goHomeNow()">‚Üê Back to Home</button>

  </form>

<script>
  // 1. Your Google Apps Script Web App URL (must end in /exec)
  const endpoint = "YOUR_WEB_APP_URL_HERE";

  // 2. Send user back to MindCheck home
  function goHomeNow() {
    window.location.href = "https://speakoutmentalhealth.github.io/MindCheck/";
  }

  // 3. Handle the form submit
  async function safeSubmit(e) {
    e.preventDefault();

    const formEl = e.target;
    const formData = Object.fromEntries(new FormData(formEl).entries());

    // Attach anonymous UID from local storage (if available)
    try {
      formData.uid = localStorage.getItem("mc_uid") || "anonymous";
    } catch (_) {
      formData.uid = "anonymous";
    }

    let networkOK = false;
    let bodyJSON = null;

    try {
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });

      networkOK = res.ok; // true if HTTP 200-299

      // Try to parse JSON, but don't crash if it's plain text
      try {
        bodyJSON = await res.json();
      } catch (parseErr) {
        bodyJSON = null;
      }

    } catch (fetchErr) {
      // fetch itself failed (no internet, etc.)
      networkOK = false;
    }

    // Success rules:
    // - We got valid JSON and ok:true
    // - OR we got a 200-ish response and no JSON (Apps Script sometimes returns text)
    const success =
      (bodyJSON && bodyJSON.ok === true) ||
      (networkOK && !bodyJSON);

    if (success) {
      alert("‚úÖ Thank you for speaking up. You did the right thing.");
      formEl.reset();
      goHomeNow();
    } else {
      alert("‚ö† Error sending report. Please tell a trusted adult or call 112.");
    }
  }

  // 4. Attach submit listener
  document
    .getElementById("reportForm")
    .addEventListener("submit", safeSubmit);
  } async function safeSubmit(e) { function goHomeNow() { goBack(); }
</script>


</body>
</html>

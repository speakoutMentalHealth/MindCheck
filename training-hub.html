<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck ‚Äî Training Hub</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#22c55e"/>

  <style>
    .lesson { background:#fff; border:1px solid #e8eef5; border-radius:14px; padding:14px; margin:12px 0; text-align:left; }
    .lesson h3 { margin:.25rem 0 .35rem; font-size:1.08rem; }
    .lesson ul { margin:.4rem 0 .25rem; padding-left:18px; }
    .lesson li { margin:.25rem 0; }
    .muted { color:#52606d; }
    .quiz-card { background:#fff; border:1px solid #e8eef5; border-radius:14px; padding:16px; }
    .q { margin:12px 0; text-align:left; }
    .q legend { font-weight:700; margin-bottom:6px; }
    .q label { display:block; padding:6px 8px; border:1px solid #e8eef5; border-radius:10px; margin:6px 0; cursor:pointer; }
    .q input { margin-right:8px; }
    .result { display:none; margin-top:12px; font-weight:700; }
    .good { color:#166534; }
    .bad { color:#7f1d1d; }
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px;}
    .pill { border:1px solid #e8eef5; background:#fff; border-radius:999px; padding:6px 10px; font-weight:700; }
    .timer { font-weight:800; }
    .warn { color:#854d0e; }
  </style>

  <!-- Plausible (already used across your site) -->
  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>

  <!-- Page-view custom event -->
  <script>
    (function(){
      try { window.plausible && window.plausible('TrainingHubViewed'); } catch (e) {}
    })();
  </script>
</head>
<body>
  <header>üß† SpeakOut MindCheck Nigeria</header>

  <main>
    <h2>Start Your Certified Training</h2>
    <p class="muted" style="max-width:780px;margin:0 auto;">
      Complete the lessons and take the quiz. You have <b>10 minutes</b>. Score at least <b>80%</b> to earn your
      <b>Volunteer Trained</b> badge, gain +50 points, and download your certificate.
    </p>

    <!-- In-depth Lessons -->
    <section class="lesson">
      <h3>Lesson 1 ‚Äî Safe Listening Basics (L-I-S-T-E-N)</h3>
      <p class="muted">Your role is to create psychological safety and help the person feel heard.</p>
      <ul>
        <li><b>L ‚Äî Listen:</b> Be fully present; avoid interrupting or multi-tasking.</li>
        <li><b>I ‚Äî Inquire:</b> Use open questions: ‚ÄúHow long have you felt this way?‚Äù</li>
        <li><b>S ‚Äî Summarize:</b> Reflect key points: ‚ÄúWhat I‚Äôm hearing is‚Ä¶‚Äù</li>
        <li><b>T ‚Äî Thank:</b> ‚ÄúThank you for trusting me with this.‚Äù</li>
        <li><b>E ‚Äî Empathize:</b> Validate feelings: ‚ÄúThat sounds really heavy.‚Äù</li>
        <li><b>N ‚Äî Next steps:</b> Agree one small, doable action (call, text, rest, water).</li>
      </ul>
      <p class="muted"><b>Do:</b> slow down, use calm tone, allow silence. <b>Don‚Äôt:</b> minimize, rush, or preach.</p>
    </section>

    <section class="lesson">
      <h3>Lesson 2 ‚Äî Red Flags & Immediate Danger</h3>
      <p class="muted">Some signals require urgent escalation to emergency services (112) or a supervisor.</p>
      <ul>
        <li><b>Imminent risk:</b> Active self-harm plan, current violence, loss of consciousness.</li>
        <li><b>Severe symptoms:</b> Command hallucinations, severe agitation, unable to care for self.</li>
        <li><b>Safeguarding:</b> Abuse of a child/vulnerable adult ‚Üí follow safeguarding protocol.</li>
        <li><b>Action:</b> Stay with the person (phone/chat), call <b>112</b>, contact supervisor, document minimal facts.</li>
      </ul>
    </section>

    <section class="lesson">
      <h3>Lesson 3 ‚Äî Boundaries & Ethical Referral</h3>
      <p class="muted">Volunteers are not therapists. Protect both the person and yourself.</p>
      <ul>
        <li><b>Scope:</b> Listening, support, information, and <b>referral</b> only.</li>
        <li><b>Consent first:</b> Ask before sharing options or contacting anyone on their behalf.</li>
        <li><b>Choices:</b> Offer <i>several</i> reputable options (public/private/faith-based), never push one.</li>
        <li><b>Follow-up:</b> Agree how and when to check back in; don‚Äôt over-promise availability.</li>
      </ul>
    </section>

    <section class="lesson">
      <h3>Lesson 4 ‚Äî Privacy-First Logging (Minimum Necessary)</h3>
      <p class="muted">Record only what‚Äôs needed to improve care quality and monitoring ‚Äî never gossip data.</p>
      <ul>
        <li><b>What to log:</b> date, broad concern (e.g., ‚Äúanxiety, sleep‚Äù), action taken (e.g., ‚Äúreferred to clinic‚Äù).</li>
        <li><b>What to avoid:</b> full names, contact details, unnecessary medical history, screenshots.</li>
        <li><b>Storage:</b> Secure tools; restrict access; follow your data retention policy.</li>
      </ul>
    </section>

    <section class="lesson">
      <h3>Lesson 5 ‚Äî Cultural Sensitivity & Self-Care</h3>
      <ul>
        <li><b>Cultural lens:</b> Respect beliefs and language preferences; avoid assumptions.</li>
        <li><b>Stigma aware:</b> Use non-judgmental wording; avoid labels.</li>
        <li><b>Volunteer wellness:</b> Debrief tough cases, take breaks, and escalate when unsure.</li>
      </ul>
    </section>

    <!-- Quiz -->
    <section class="quiz-card">
      <h3>Volunteer Quiz</h3>

      <p class="muted" style="text-align:left">
        <span class="pill">Pass mark: 80%</span>
        <span class="pill">Time: <span id="timeLeft" class="timer">10:00</span></span>
      </p>

      <div class="toolbar" id="preQuizBar">
        <button id="startQuiz" class="btn btn-primary" type="button">Start Quiz</button>
        <a class="btn btn-ghost" href="volunteers.html">‚Üê Back to Volunteer Zone</a>
      </div>

      <form id="quizForm" style="display:none"></form>

      <div class="toolbar" id="quizBtns" style="display:none">
        <button id="submitQuiz" class="btn btn-primary" type="button">Submit Quiz</button>
        <button id="resetQuiz" class="btn btn-ghost" type="button">Reset</button>
        <a class="btn btn-ghost" href="volunteers.html">‚Üê Back to Volunteer Zone</a>
      </div>

      <div id="quizResult" class="result"></div>

      <!-- Certificate and completion block -->
      <div id="postPass" class="card" style="display:none;margin-top:12px;text-align:left;">
        <h3>‚úÖ You passed!</h3>
        <p class="muted">Your <b>Volunteer Trained</b> badge is unlocked (+50 points).</p>

        <label style="display:block;margin:10px 0 6px;font-weight:700;">Your full name (for certificate)</label>
        <input id="certName" class="btn btn-ghost" style="width:100%;text-align:left" placeholder="Type your name as it should appear"/>

        <div class="toolbar" style="justify-content:flex-start;margin-top:10px;">
          <button id="makeCert" class="btn btn-primary" type="button">Generate Certificate</button>
          <a class="btn btn-ghost" href="index.html">Open MindCheck Home</a>
          <a class="btn btn-ghost" href="resources.html">Clinics & Resources</a>
        </div>

        <!-- Optional verification link reminder -->
        <p class="muted" style="margin-top:10px">
          Need to verify a certificate later? Use <a href="verify.html" target="_blank" rel="noopener">Verify Certificate</a>.
        </p>

        <p id="certHint" class="muted" style="display:none;margin-top:8px;"></p>
      </div>
    </section>
  </main>

  <footer style="margin-top:20px;">
    üîí <a href="privacy.html">Privacy</a> ‚Ä¢
    üìÑ <a href="terms.html">Terms</a> ‚Ä¢
    üè• <a href="resources.html">Clinics & Resources</a> ‚Ä¢
    ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
  </footer>

  <script>
    // ---------- Storage & constants ----------
    const KEY_POINTS='mc_points', KEY_BADGES='mc_badges', KEY_TRAINING='mc_training', KEY_TRAINING_LOG='mc_training_log', KEY_TIMER_START='mc_training_timer_start';
    const PASS_MARK=0.8, BONUS=50, QUIZ_SECONDS=10*60; // 10 minutes

    const getJSON=(k,f)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(f))}catch(e){return f}};
    const setJSON=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
    const getPoints=()=>parseInt(localStorage.getItem(KEY_POINTS)||'0',10);
    const setPoints=v=>localStorage.setItem(KEY_POINTS,String(v));
    const addPoints=n=>setPoints(getPoints()+n);
    const getBadges=()=>getJSON(KEY_BADGES,[]);
    const setBadges=a=>setJSON(KEY_BADGES,a);
    const awardBadge=id=>{const b=getBadges();if(!b.includes(id)){b.push(id);setBadges(b);return true}return false};
    const logPass=pct=>{const log=getJSON(KEY_TRAINING_LOG,[]);log.push({date:new Date().toISOString(),pct});setJSON(KEY_TRAINING_LOG,log);};

    // ---------- Questions (15) ----------
    const QUESTIONS=[
      {q:"Which response best shows safe listening?",a:["Interrupt to give solutions","Listen, reflect, ask open questions","Tell them others have it worse"],c:1},
      {q:"Which is an immediate red flag?",a:["Occasional sadness","Active self-harm plan","Feeling tired after work"],c:1},
      {q:"Volunteers should avoid:",a:["Offering clinic options","Promising limited confidentiality","Giving medical advice/diagnoses"],c:2},
      {q:"If danger is happening now, what‚Äôs the first action?",a:["Keep chatting","Call 112 immediately","Tell them to relax"],c:1},
      {q:"Privacy-first logging means:",a:["Use initials only, minimal facts","Write their full name and story","Screenshot the chat for records"],c:0},
      {q:"Before making a referral you should:",a:["Get consent and offer choices","Choose one clinic for them","Ask for their full medical history"],c:0},
      {q:"Boundaries help because they:",a:["Prevent burnout and role drift","Make you uncaring","Stop you from listening"],c:0},
      {q:"A good empathic reflection is:",a:["You‚Äôre overreacting","It sounds like this is hard for you","Calm down"],c:1},
      {q:"If unsure what to do:",a:["Do nothing","Escalate to supervisor/safeguarding lead","Post on social media for advice"],c:1},
      {q:"A small next step might be:",a:["Plan their whole life","Agree they call a clinic tomorrow","End abruptly"],c:1},
      {q:"Which is appropriate to log?",a:["Date + concern + action taken","Their full name and address","Screenshots of messages"],c:0},
      {q:"Cultural sensitivity includes:",a:["Respecting beliefs & language","Assuming everyone thinks alike","Correcting their culture"],c:0},
      {q:"When a child may be at risk, you should:",a:["Keep it secret","Follow safeguarding protocol and escalate","Handle it alone without records"],c:1},
      {q:"During listening, silence is:",a:["Useful to give space","A sign you‚Äôre failing","To be avoided"],c:0},
      {q:"Consent in referrals means:",a:["Acting without telling them","Getting their informed permission","Telling them they must accept"],c:1}
    ];

    // ---------- DOM ----------
    const form=document.getElementById('quizForm');
    const preQuizBar=document.getElementById('preQuizBar');
    const quizBtns=document.getElementById('quizBtns');
    const result=document.getElementById('quizResult');
    const post=document.getElementById('postPass');
    const timeLeftEl=document.getElementById('timeLeft');

    function renderQuiz(){
      form.innerHTML=QUESTIONS.map((Q,i)=>`
        <fieldset class="q">
          <legend>Q${i+1}. ${Q.q}</legend>
          ${Q.a.map((opt,j)=>`<label><input type="radio" name="q${i}" value="${j}" required/> ${opt}</label>`).join('')}
        </fieldset>
      `).join('');
    }

    // ---------- Timer ----------
    let timerId=null;
    function fmt(sec){ const m=Math.floor(sec/60), s=sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

    function startTimer(){
      // store a start timestamp so refreshes don‚Äôt reset the clock
      const now=Date.now();
      if(!localStorage.getItem(KEY_TIMER_START)){
        localStorage.setItem(KEY_TIMER_START,String(now));
      }
      tickTimer(); // immediate paint
      timerId=setInterval(tickTimer,1000);
      try{ window.plausible && window.plausible('TrainingTimerStarted'); }catch(e){}
    }

    function remainingSeconds(){
      const started=parseInt(localStorage.getItem(KEY_TIMER_START)||'0',10);
      if(!started) return QUIZ_SECONDS;
      const elapsed=Math.floor((Date.now()-started)/1000);
      return Math.max(0, QUIZ_SECONDS - elapsed);
    }

    function tickTimer(){
      const r=remainingSeconds();
      timeLeftEl.textContent=fmt(r);
      if(r<=60) timeLeftEl.classList.add('warn'); // last minute styling
      if(r<=0){
        clearInterval(timerId);
        timeLeftEl.textContent='00:00';
        autoSubmitOnTimeout();
      }
    }

    function disableQuiz(){
      form.querySelectorAll('input[type=radio]').forEach(el=>el.disabled=true);
      document.getElementById('submitQuiz').disabled=true;
    }

    function autoSubmitOnTimeout(){
      try{ window.plausible && window.plausible('TrainingTimerExpired'); }catch(e){}
      gradeQuiz(true); // true = timed out
      disableQuiz();
    }

    // ---------- Events ----------
    document.getElementById('startQuiz').onclick=()=>{
      preQuizBar.style.display='none';
      form.style.display='block';
      quizBtns.style.display='flex';
      renderQuiz();
      startTimer();
    };

    document.getElementById('submitQuiz').onclick=()=>gradeQuiz(false);

    document.getElementById('resetQuiz').onclick=()=>{
      // reset current attempt (not lessons)
      form.reset();
      result.style.display='none'; post.style.display='none';
      // reset timer
      localStorage.removeItem(KEY_TIMER_START);
      timeLeftEl.classList.remove('warn');
      timeLeftEl.textContent=fmt(QUIZ_SECONDS);
      // allow a fresh attempt
      clearInterval(timerId);
      form.style.display='none';
      quizBtns.style.display='none';
      preQuizBar.style.display='flex';
    };

    // ---------- Grading ----------
    function gradeQuiz(timedOut){
      if(form.style.display==='none'){ return; } // nothing to grade yet
      // Ensure required validation unless timed out
      if(!timedOut && !form.checkValidity()){form.reportValidity();return;}

      let correct=0;
      QUESTIONS.forEach((Q,i)=>{
        const ch=form.querySelector(`input[name=q${i}]:checked`);
        if(ch && parseInt(ch.value,10)===Q.c) correct++;
      });

      const pct=correct/QUESTIONS.length;
      setJSON(KEY_TRAINING,{pct,date:new Date().toISOString()});
      const pass=pct>=PASS_MARK;

      result.style.display='block';
      result.className='result '+(pass?'good':'bad');
      const tag = timedOut ? ' (time up)' : '';
      result.textContent=`You scored ${correct}/${QUESTIONS.length} (${Math.round(pct*100)}%). ${pass?'You passed!':'Try again.'}${tag}`;

      if(pass){
        awardBadge('volunteer_trained');
        addPoints(BONUS);
        logPass(pct);
        post.style.display='block';
        try{ window.plausible && window.plausible('VolunteerQuizPassed',{props:{score:Math.round(pct*100)}});}catch(e){}
      }else{
        post.style.display='none';
        try{ window.plausible && window.plausible('VolunteerQuizFailed',{props:{score:Math.round(pct*100), timedOut: !!timedOut}});}catch(e){}
      }
    }

    // ---------- Certificate ----------
    const makeBtn=document.getElementById('makeCert'),certInput=document.getElementById('certName'),hint=document.getElementById('certHint');
    makeBtn.onclick=()=>{
      const name=(certInput.value||'').trim();if(!name){alert('Enter your name');return;}
      const t=getJSON(KEY_TRAINING,{pct:1,date:new Date().toISOString()});
      const score=Math.round(t.pct*100),d=encodeURIComponent(t.date);
      const url=`certificate.html?name=${encodeURIComponent(name)}&score=${score}&date=${d}`;
      hint.style.display='block';
      hint.innerHTML=`Your certificate is ready: <a href="${url}" target="_blank" rel="noopener" class="btn btn-ghost">Open Certificate</a>`;
      try{ window.plausible && window.plausible('VolunteerCertificateOpen',{props:{score}});}catch(e){}
    };

    // Initialize timer display for first load
    timeLeftEl.textContent = '10:00';
  </script>
</body>
</html>

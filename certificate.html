<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck ‚Äî Certificate</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#22c55e"/>

  <style>
    body {
      background: #f3f4f6;
    }
    .cert-wrapper {
      max-width: 1100px;
      margin: 16px auto 32px;
      padding: 0 8px;
    }
    .cert-frame {
      background: linear-gradient(135deg,#d4af37,#f6e27a);
      padding: 5px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
    }
    .cert {
      position: relative;
      background:#ffffff;
      border-radius: 16px;
      padding: 24px 40px 26px;
      min-height: 520px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      overflow:hidden;
    }
    /* Watermark */
    .cert::before {
      content:"";
      position:absolute;
      inset:60px 120px;
      background:url("icons/logo.png") center/260px auto no-repeat;
      opacity:0.06;
      pointer-events:none;
    }

    .cert-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:10px;
      position:relative;
      z-index:1;
    }
    .cert-logo {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .cert-logo img {
      max-height:56px;
      width:auto;
      display:block;
    }
    .cert-brand {
      text-align:left;
    }
    .cert-brand-title {
      font-weight:800;
      font-size:1.25rem;
    }
    .cert-brand-sub {
      font-size:.9rem;
      color:#6b7280;
    }

    .cert-body {
      text-align:center;
      margin-top:12px;
      margin-bottom:18px;
      position:relative;
      z-index:1;
    }
    .cert-title {
      font-size:1.8rem;
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
      margin-bottom:4px;
    }
    .cert-subtitle {
      font-size:.95rem;
      color:#6b7280;
      margin-bottom:10px;
    }
    .cert-name-label {
      color:#6b7280;
      margin-bottom:2px;
    }
    .cert-name {
      font-size:1.6rem;
      font-weight:800;
      margin-bottom:6px;
    }
    .cert-text {
      max-width:680px;
      margin:0 auto;
      color:#4b5563;
      font-size:.98rem;
      line-height:1.6;
    }

    .cert-meta {
      display:flex;
      justify-content:center;
      gap:24px;
      margin-top:12px;
      font-size:.9rem;
      color:#4b5563;
    }
    .cert-meta span b {
      font-weight:700;
    }

    .cert-footer {
      margin-top:24px;
      display:flex;
      justify-content:space-between;
      gap:20px;
      align-items:flex-end;
      position:relative;
      z-index:1;
    }

    .sign-block {
      text-align:left;
    }
    .sign-image {
      height:70px;
      display:block;
      margin-bottom:2px;
    }
    .sign-line {
      border-bottom:1.5px solid #9ca3af;
      width:220px;
      margin-bottom:4px;
    }
    .sign-name {
      font-weight:800;
      font-size:1rem;
      margin-bottom:2px;
    }
    .sign-role {
      font-size:.9rem;
      color:#6b7280;
    }

    .qr-block {
      text-align:right;
      font-size:.85rem;
      color:#4b5563;
    }
    .qr-block img {
      width:120px;
      height:120px;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#f9fafb;
      display:block;
      margin-left:auto;
      margin-bottom:6px;
    }
    .cert-id {
      font-family:ui-monospace,Consolas,monospace;
      font-size:.9rem;
      padding:3px 7px;
      border-radius:999px;
      border:1px dashed #d4af37;
      background:#fefce8;
      display:inline-block;
      margin-top:4px;
    }

    .no-print-row {
      margin-top:16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
    }

    @media (max-width:768px){
      .cert {
        padding:18px 16px 20px;
        min-height:auto;
      }
      .cert-header {
        flex-direction:column;
        align-items:flex-start;
      }
      .cert-footer {
        flex-direction:column;
        align-items:flex-start;
      }
      .qr-block {
        text-align:left;
      }
      .qr-block img {
        margin-left:0;
      }
    }

    @media print {
      body {
        background:#ffffff;
      }
      header, footer, .no-print-row {
        display:none !important;
      }
      .cert-wrapper {
        max-width:none;
        margin:0;
        padding:0;
      }
      .cert-frame {
        border-radius:0;
        padding:4px;
        box-shadow:none;
      }
      .cert {
        border-radius:0;
        min-height:auto;
        height:100%;
      }
      @page {
        size: A4 landscape;
        margin: 10mm;
      }
    }
  </style>

  <!-- Plausible analytics -->
  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
  <script>
    (function(){
      try { window.plausible && window.plausible('CertificateViewed'); } catch(e){}
    })();
  </script>
</head>
<body>
  <header>üß† SpeakOut MindCheck Nigeria</header>

  <main class="cert-wrapper">
    <div class="cert-frame">
      <div class="cert">
        <!-- Top -->
        <div class="cert-header">
          <div class="cert-logo">
            <img src="icons/logo.png" alt="SpeakOut MindCheck logo"/>
            <div class="cert-brand">
              <div class="cert-brand-title">SpeakOut MindCheck Nigeria</div>
              <div class="cert-brand-sub">School & community mental-health screening initiative</div>
            </div>
          </div>
        </div>

        <!-- Body -->
        <div class="cert-body">
          <div class="cert-title">Certificate of Volunteer Training</div>
          <div class="cert-subtitle">
            This certifies that the volunteer named below has completed MindCheck‚Äôs core training
            in safe listening, red-flag triage, ethical referral, privacy-first logging, and self-care.
          </div>

          <p class="cert-name-label">Awarded to</p>
          <p id="cName" class="cert-name">‚Äî</p>

          <p class="cert-text">
            By completing the SpeakOut MindCheck Volunteer Training and achieving the required pass mark,
            this volunteer has demonstrated the ability to listen respectfully, recognize risk, escalate
            emergencies without delay, protect privacy using minimum-necessary notes, and connect
            help-seekers to appropriate services and follow-up support in line with WHO-style community
            mental-health action.
          </p>

          <div class="cert-meta">
            <span><b>Score:</b> <span id="cScore">‚Äî</span>%</span>
            <span><b>Date:</b> <span id="cDate">‚Äî</span></span>
          </div>
        </div>

        <!-- Footer: signature + QR -->
        <div class="cert-footer">
          <div class="sign-block">
            <img src="icons/signature.png" alt="Signature of Offorka Jerry" class="sign-image"/>
            <div class="sign-line"></div>
            <div class="sign-name">Offorka Jerry</div>
            <div class="sign-role">Founder / Executive Director, SpeakOut Mental Health Outreach</div>
          </div>

          <div class="qr-block">
            <img id="qrImg" alt="QR code for certificate verification"/>
            <div>Certificate ID</div>
            <div id="certId" class="cert-id">‚Äî</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Buttons + verify link (screen only) -->
    <div class="no-print-row">
      <button class="btn btn-primary" onclick="window.print()">Download / Print PDF</button>
      <a class="btn btn-ghost" href="training-hub.html">‚Üê Back to Training</a>
      <a class="btn btn-ghost" href="index.html">Home</a>
    </div>

    <div class="no-print-row" style="margin-top:8px;font-size:.9rem;color:#4b5563;">
      <span>To confirm this certificate online,&nbsp;
        <a href="verify.html" id="verifyLink">verify here</a>.
      </span>
    </div>
  </main>

  <footer class="no-print-row" style="margin-top:10px;">
    üîí <a href="privacy.html">Privacy</a> ‚Ä¢
    üìÑ <a href="terms.html">Terms</a> ‚Ä¢
    üè• <a href="resources.html">Clinics & Resources</a> ‚Ä¢
    ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
  </footer>

  <script>
    // Parse ?name=...&score=...&date=...&cert_id=...
    const params = new URLSearchParams(location.search);
    const name = params.get('name') || 'Volunteer';
    const score = params.get('score') || '';
    const dateParam = params.get('date');
    const certIdParam = params.get('cert_id') || '';

    const scoreNum = score ? parseInt(score, 10) : NaN;
    const dateObj = dateParam ? new Date(decodeURIComponent(dateParam)) : new Date();

    document.getElementById('cName').textContent = name;
    document.getElementById('cScore').textContent = isNaN(scoreNum) ? '‚Äî' : scoreNum;
    document.getElementById('cDate').textContent = dateObj.toLocaleDateString();

    // Show certificate ID (or fallback if none)
    const certIdEl = document.getElementById('certId');
    let certId = certIdParam || 'UNREGISTERED';
    certIdEl.textContent = certId;

    // Build QR for verification page (if we have a real ID)
    const qrImg = document.getElementById('qrImg');
    if (certId && certId !== 'UNREGISTERED') {
      const verifyUrl = new URL('verify.html', window.location.href);
      verifyUrl.searchParams.set('id', certId);
      const qrData = verifyUrl.toString();
      qrImg.src = 'https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=' + encodeURIComponent(qrData);
    } else {
      qrImg.style.display = 'none';
    }

    // Friendly fallback if opened directly (no URL params)
    if (!params.get('name')) {
      try {
        const t = JSON.parse(localStorage.getItem('mc_training') || '{}');
        if (t.pct) {
          document.getElementById('cScore').textContent = Math.round(t.pct * 100);
          document.getElementById('cDate').textContent = new Date(t.date || Date.now()).toLocaleDateString();
        }
      } catch(e){}
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MindCheck Certificate</title>

  <style>
    :root{
      --ink:#0b1f2a;
      --muted:#5b6b79;
      --green:#16a34a;
    }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:#f3f4f6;
      color:var(--ink);
    }

    .screenWrap{
      max-width: 1200px;
      margin: 14px auto;
      padding: 12px;
    }

    /* A4 Landscape */
    .page{
      width: 297mm;
      height: 210mm;
      background:#fff;
      margin: 0 auto;
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      box-sizing:border-box;
    }

    .inner{
      position:absolute;
      inset: 10mm;
      border: 2px solid rgba(17,24,39,.65);
      border-radius: 10px;
      padding: 10mm 10mm 18mm; /* extra bottom space for footer */
      box-sizing:border-box;
    }

    /* Top logos row */
    .topBar{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 14mm;
      margin-bottom: 4mm;
    }
    .logo{
      width: 46mm;
      height: 24mm;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .logo img{
      max-height: 24mm;
      max-width: 46mm;
      width:auto;
      height:auto;
      object-fit:contain;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.08));
    }

    .title{
      text-align:center;
      font-weight: 950;
      letter-spacing: .11em;
      font-size: 16pt;
      margin: 2mm 0 3mm;
    }

    .sub{
      text-align:center;
      color:var(--muted);
      font-weight: 700;
      font-size: 10.3pt;
      line-height:1.35;
      max-width: 245mm;
      margin: 0 auto 5mm;
    }

    .presented{
      text-align:center;
      margin-top: 4mm;
      color: var(--muted);
      font-weight: 950;
      letter-spacing: .18em;
      font-size: 9.2pt;
    }

    .name{
      text-align:center;
      font-size: 26pt;
      font-weight: 950;
      margin: 3mm 0 3mm;
    }

    .bodyText{
      text-align:center;
      font-size: 10.3pt;
      font-weight: 650;
      color:#22303c;
      line-height:1.45;
      max-width: 245mm;
      margin: 0 auto;
    }

    .metaRow{
      display:flex;
      justify-content:center;
      gap: 22mm;
      margin-top: 5mm;
      font-weight: 950;
      color:#1f2937;
      font-size: 10pt;
    }

    /* Footer: fixed bottom, never overlaps content */
    .footerRow{
      position:absolute;
      left: 10mm;
      right: 10mm;
      bottom: 8mm;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 8mm;
    }

    /* Signature column (LEFT) */
    .sig{
      width: 95mm;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      justify-content:flex-end;
    }

    /* Signature image: big, bold, and near the line */
    .sigImg{
      height: 56mm;          /* BIG */
      width: auto;
      max-width: 90mm;
      object-fit: contain;

      /* pull signature DOWN closer to the line */
      margin: 0 0 -1mm 0;

      /* make it look bolder/inked */
      filter:
        contrast(1.45)
        saturate(1.2)
        drop-shadow(0 0 0.9px rgba(0,0,0,.85));
    }

    .sigLine{
      border-top: 2px solid rgba(17,24,39,.65);
      width: 90mm;
      margin: 0 0 2mm 0;
    }

    .sig small{
      display:block;
      color:var(--muted);
      font-weight: 800;
      line-height:1.25;
    }

    /* Certificate ID box (RIGHT) */
    .certBox{
      width: 92mm;
      min-width: 92mm;
      border: 2px dashed rgba(17,24,39,.55);
      border-radius: 10px;
      padding: 5mm;
      box-sizing:border-box;
      text-align:left;
      background: linear-gradient(180deg, rgba(22,163,74,.06), transparent 55%);
    }

    .certBox b{
      display:block;
      font-size: 10.5pt;
      margin-bottom: 2mm;
    }
    .certId{
      font-weight: 950;
      letter-spacing: .04em;
      font-size: 10pt;
      margin-bottom: 3mm;
      word-break: break-word;
    }

    .qrRow{
      display:flex;
      gap: 5mm;
      align-items:center;
    }
    .qr{
      width: 26mm;
      height: 26mm;
      border:1px solid rgba(0,0,0,.12);
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      background:#fff;
    }
    .qr img{ width:100%; height:100%; object-fit:cover; }

    .verifyTxt{
      color:var(--muted);
      font-weight: 800;
      font-size: 9.3pt;
      line-height:1.25;
    }
    .verifyTxt a{ color: var(--green); font-weight: 950; text-decoration:none; }
    .verifyTxt a:hover{ text-decoration:underline; }

    /* Print exactly one A4 landscape page */
    @page { size: A4 landscape; margin: 0; }
    @media print{
      body{ background:#fff; }
      .screenWrap{ margin:0; padding:0; }
      .page{ border:none; border-radius:0; width: 297mm; height: 210mm; }
    }

    /* Mobile preview scaling only (doesn't affect print) */
    @media (max-width: 900px){
      .screenWrap{ padding: 8px; }
      .page{ width:100%; height:auto; aspect-ratio: 297 / 210; }
    }
  </style>
</head>

<body>
  <div class="screenWrap">
    <div class="page" id="page">
      <div class="inner">

        <!-- Logos -->
        <div class="topBar">
          <div class="logo">
            <img src="icons/apple-touch-icon.png" alt="SpeakOut / MindCheck Logo">
          </div>
          <div class="logo">
            <img src="icons/synia-logo.png" alt="Synia Aid Foundation Logo">
          </div>
          <div class="logo">
            <img src="icons/afrihud-logo.png" alt="AfriHud Logo">
          </div>
        </div>

        <div class="title">CERTIFICATE OF JOINT VOLUNTEER TRAINING</div>

        <div class="sub">
          This certifies that the volunteer named below has successfully completed the <b>MindCheck Joint Volunteer Training</b>
          delivered by <b>SpeakOut Mental Health Outreach</b>, in partnership with <b>Synia Aid Foundation</b> & <b>AfriHud</b>,
          covering safe listening, risk recognition, privacy-first logging, and ethical referral for community & humanitarian settings.
        </div>

        <div class="presented">THIS CERTIFICATE IS PROUDLY PRESENTED TO</div>
        <div class="name" id="name">Volunteer Name</div>

        <div class="bodyText">
          By achieving the required pass mark, this volunteer is recognised as a trained MindCheck community supporter,
          equipped to offer basic psychosocial support in a safe, respectful way and connect people to appropriate help.
        </div>

        <div class="metaRow">
          <div>Score: <span id="score">0</span>%</div>
          <div>Date: <span id="date">—</span></div>
        </div>

        <!-- Footer -->
        <div class="footerRow">

          <!-- Signature side -->
          <div class="sig">
            <img class="sigImg" src="icons/signature.png" alt="Signature of Offorka Jerry">
            <div class="sigLine"></div>

            <small><b>Offorka Jerry</b></small>
            <small>Founder / Executive Director</small>
            <small>SpeakOut Mental Health Outreach</small>
            <small>(Lead partner — MindCheck Joint Volunteer Training)</small>
          </div>

          <!-- Certificate box -->
          <div class="certBox">
            <b>Certificate ID</b>
            <div class="certId" id="certId">MC-CERT-YYYYMMDD-XXXX</div>

            <div class="qrRow">
              <div class="qr">
                <img id="qrImg" src="icons/qr-placeholder.png" alt="QR code"/>
              </div>
              <div class="verifyTxt">
                Scan to confirm.<br/>
                Or verify online:<br/>
                <a id="verifyLink" href="verify.html" target="_blank" rel="noopener">verify here</a>
              </div>
            </div>
          </div>

        </div><!-- /footerRow -->

      </div><!-- /inner -->
    </div><!-- /page -->
  </div><!-- /screenWrap -->

<script>
  // URL params: certificate.html?name=...&score=...&date=...&cert_id=...&uid=...
  const p = new URLSearchParams(location.search);
  const name   = p.get('name') || 'Volunteer';
  const score  = p.get('score') || '0';
  const dateIso= p.get('date')  || new Date().toISOString();
  const certId = p.get('cert_id') || 'MC-CERT-UNKNOWN';

  document.getElementById('name').textContent = name;
  document.getElementById('score').textContent = score;

  const dt = new Date(dateIso);
  document.getElementById('date').textContent = isNaN(dt.getTime()) ? dateIso : dt.toLocaleDateString();

  document.getElementById('certId').textContent = certId;

  // Verify link carries cert_id
  const verifyUrl = `verify.html?cert_id=${encodeURIComponent(certId)}`;
  document.getElementById('verifyLink').href = verifyUrl;

  // Optional: QR generator later (uncomment when ready)
  // document.getElementById('qrImg').src =
  //   `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(location.origin + '/' + verifyUrl)}`;

  // Log certificate view to Google Sheet (no-cors for GitHub Pages)
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxmkC25_qQhxydDmRjjZa_efL-wQwGYysAIIxJ3YkIavJqLr5XVsNHv9okO2d3Epm4vfA/exec";
  const BEARER  = "speakout123";

  async function logToSheet(payload){
    try{
      await fetch(GAS_URL + "?auth=" + encodeURIComponent(BEARER), {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });
    }catch(e){
      console.warn("Sheet log failed:", e);
    }
  }

  logToSheet({
    auth: BEARER,
    type: "certificate_view",
    cert_id: certId,
    name: name,
    score: Number(score) || score,
    date: dateIso,
    uid: p.get("uid") || (localStorage.getItem("mc_uid") || "")
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck ‚Äî Certificate</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#22c55e"/>

  <style>
    body {
      background:#f5fdf8;
    }
    .cert-wrap {
      max-width:1100px;
      margin:18px auto;
      padding:0 8px;
    }
    .cert {
      background:#ffffff;
      border:2px solid #e5e7eb;
      border-radius:18px;
      padding:24px 32px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      min-height:520px; /* landscape feel */
      box-shadow:0 10px 30px rgba(15,23,42,.08);
    }
    .cert-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .cert-header-left {
      display:flex;
      align-items:center;
      gap:12px;
    }
    .cert-logo {
      width:72px;
      height:72px;
      border-radius:16px;
      background:#f0fdf4;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:32px;
    }
    .cert-title-block h1 {
      font-size:1.5rem;
      margin:0;
    }
    .cert-title-block p {
      margin:2px 0 0;
      color:#64748b;
      font-size:.95rem;
    }
    .cert-body {
      text-align:center;
      margin:20px 0;
    }
    .cert-body .muted {
      color:#64748b;
    }
    .cert-name {
      font-size:1.7rem;
      font-weight:800;
      margin:8px 0;
    }
    .cert-info {
      margin-top:10px;
      font-size:.97rem;
      color:#475569;
    }
    .cert-footer {
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:18px;
      margin-top:24px;
      align-items:flex-end;
    }
    .sig-block {
      text-align:center;
      min-width:220px;
    }
    .sig-image {
      height:60px;
      margin-bottom:4px;
    }
    .sig-line {
      border-top:1px solid #cbd5f5;
      margin-top:4px;
      padding-top:4px;
      font-size:.9rem;
    }
    .sig-name {
      font-weight:700;
    }
    .sig-title {
      color:#6b7280;
      font-size:.85rem;
    }
    .details-block {
      font-size:.9rem;
      color:#64748b;
      text-align:right;
      min-width:240px;
    }
    .details-block div {
      margin:2px 0;
    }
    .badge-seal {
      font-size:40px;
      margin-bottom:4px;
    }
    .no-print {
      margin-top:16px;
      text-align:center;
    }
    @media print {
      body {
        background:#ffffff;
      }
      .no-print {
        display:none !important;
      }
      @page {
        size: A4 landscape;
        margin:20mm;
      }
      .cert-wrap {
        max-width:none;
        margin:0;
        padding:0;
      }
      .cert {
        box-shadow:none;
        border-width:1px;
      }
    }
  </style>

  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
</head>
<body>
  <header>üß† SpeakOut MindCheck Nigeria</header>

  <main class="cert-wrap">
    <div class="cert">
      <div class="cert-header">
        <div class="cert-header-left">
          <!-- Replace src with your real logo file -->
          <div class="cert-logo">
            <img src="images/speakout-logo.png" alt="SpeakOut Logo" style="max-width:100%;max-height:100%;border-radius:16px;"/>
          </div>
          <div class="cert-title-block">
            <h1>Certificate of Volunteer Training</h1>
            <p>Issued by SpeakOut MindCheck Nigeria</p>
          </div>
        </div>
        <div class="badge-seal">üèÖ</div>
      </div>

      <div class="cert-body">
        <p class="muted">This certifies that</p>
        <p id="cName" class="cert-name">Volunteer Name</p>
        <p class="muted">
          has successfully completed the SpeakOut MindCheck volunteer training and demonstrated
          core competencies in safe listening, red-flag triage, ethical referral and privacy-first logging.
        </p>

        <div class="cert-info">
          <div><b>Score:</b> <span id="cScore">‚Äî</span>%</div>
          <div><b>Date:</b> <span id="cDate">‚Äî</span></div>
          <div><b>Certificate ID:</b> <span id="cId">MCV-XXXXXXX</span></div>
        </div>
      </div>

      <div class="cert-footer">
        <div class="sig-block">
          <!-- Replace src with your actual signature image -->
          <img src="images/signature-offorka.png" alt="Signature of Offorka Jerry" class="sig-image"/>
          <div class="sig-line">
            <div class="sig-name">Offorka Jerry</div>
            <div class="sig-title">Founder / Executive Director, SpeakOut Mental Health Outreach</div>
          </div>
        </div>
        <div class="details-block">
          <div><b>Program:</b> SpeakOut MindCheck ‚Äî Volunteer Training</div>
          <div><b>Location:</b> Nigeria (Abuja ‚Ä¢ Keffi ‚Ä¢ Owerri & beyond)</div>
          <div><b>Validation:</b> Use the official Verify page to confirm this ID.</div>
        </div>
      </div>
    </div>

    <div class="no-print">
      <button class="btn btn-primary" onclick="window.print()">Download / Print PDF</button>
      <a class="btn btn-ghost" href="training-hub.html">‚Üê Back to Training Hub</a>
      <a class="btn btn-ghost" href="index.html">Home</a>
      <p class="muted" style="margin-top:8px;">
        To confirm authenticity, <a href="verify.html">verify here</a>.
      </p>
    </div>
  </main>

  <footer class="no-print">
    üîí <a href="privacy.html">Privacy</a> ‚Ä¢
    üìÑ <a href="terms.html">Terms</a> ‚Ä¢
    üè• <a href="resources.html">Clinics & Resources</a> ‚Ä¢
    ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
  </footer>

  <script>
    // === Helper: parse params ===
    const params = new URLSearchParams(location.search);
    const name = (params.get('name') || 'Volunteer').trim();
    const score = params.get('score') || '100';
    const dt = params.get('date') ? new Date(decodeURIComponent(params.get('date'))) : new Date();

    document.getElementById('cName').textContent = name || 'Volunteer';
    document.getElementById('cScore').textContent = score;
    document.getElementById('cDate').textContent = dt.toLocaleDateString();

    // If opened without params, try local storage training record
    if (!params.get('name')) {
      try {
        const t = JSON.parse(localStorage.getItem('mc_training') || '{}');
        if (t.pct) {
          document.getElementById('cScore').textContent = Math.round(t.pct * 100);
          document.getElementById('cDate').textContent = new Date(t.date || Date.now()).toLocaleDateString();
        }
      } catch(e){}
    }

    // === Generate a stable-looking Certificate ID and log to backend ===
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwbTvjd_4QXeFUmtBZxK1aldG0CtGSEELiP-koRFO-0G-IqctT32syjnSF1-Crl5tQ00A/exec';

    function makeCertId() {
      // Use local UID if available, plus date + score, hashed into short hex
      let uid = localStorage.getItem('mc_uid') || 'ANON';
      const base = (uid + '|' + name + '|' + score + '|' + dt.toISOString());
      let hash = 0;
      for (let i = 0; i < base.length; i++) {
        hash = ((hash << 5) - hash) + base.charCodeAt(i);
        hash |= 0;
      }
      const hex = (hash >>> 0).toString(16).toUpperCase().padStart(8, '0');
      return 'MCV-' + hex;
    }

    const certId = makeCertId();
    document.getElementById('cId').textContent = certId;

    // Log certificate issue to backend (for verification later)
    try {
      fetch(GAS_URL + '?auth=speakout123', {
        method:'POST',
        headers:{ 'Content-Type':'text/plain' },
        body: JSON.stringify({
          type:'certificate_issue',
          cert_id: certId,
          name,
          score: Number(score),
          date: dt.toISOString()
        })
      }).then(r => r.text())
        .then(t => { console.log('Certificate logged:', t); })
        .catch(err => console.warn('Cert log failed', err));
    } catch(e) {
      console.warn('Cert log fetch failed', e);
    }

    // Plausible event
    try { window.plausible && window.plausible('CertificateViewed', {props:{cert_id: certId}}); } catch(e){}
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck â€” Certificate</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#0f766e"/>

  <style>
    body {
      margin:0;
      padding:0;
      background:#0f172a;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    header{
      background:#0f766e;
      color:#fff;
      text-align:center;
      padding:10px 8px;
      font-weight:700;
      font-size:1.1rem;
    }
    main{
      padding:14px 4px 24px;
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .cert-wrapper{
      width:100%;
      max-width:1120px;
      aspect-ratio: 11 / 8.5; /* landscape look */
      padding:10px;
      box-sizing:border-box;
    }

    .cert {
      position:relative;
      width:100%;
      height:100%;
      background:#fdfdfb;
      box-sizing:border-box;

      /* double gold + blue border effect */
      border-radius:22px;
      border:5px solid #d4af37;
      box-shadow:
        0 0 0 4px #0f4c75,
        0 0 20px rgba(15,23,42,.35);
      padding:20px 40px;
      overflow:hidden;
    }

    /* inner decorative border */
    .cert::before{
      content:"";
      position:absolute;
      inset:18px;
      border-radius:16px;
      border:2px dashed rgba(212,175,55,0.6);
      pointer-events:none;
    }

    /* watermark */
    .cert::after{
      content:"";
      position:absolute;
      inset:90px 180px;
      background:url("icons/logo.png") center/contain no-repeat;
      opacity:0.08;
      filter:grayscale(100%);
      pointer-events:none;
    }

    .cert-inner{
      position:relative;
      z-index:1;
      height:100%;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }

    .cert-top{
      display:flex;
      align-items:center;
      gap:16px;
    }
    .cert-logo{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .cert-logo img{
      max-height:58px;
      width:auto;
    }
    .cert-title-block{
      flex:1;
      text-align:left;
    }
    .cert-title-block h1{
      margin:0;
      font-size:1.3rem;
      color:#0f172a;
      font-weight:800;
    }
    .cert-title-block p{
      margin:2px 0 0;
      font-size:.85rem;
      color:#4b5563;
      max-width:520px;
    }

    .cert-main{
      margin-top:8px;
      text-align:center;
      padding:4px 20px 0;
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .headline{
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:800;
      font-size:1rem;
      color:#0f172a;
      margin-bottom:6px;
    }
    .subhead{
      font-size:.9rem;
      color:#4b5563;
      max-width:680px;
      margin:0 auto 6px;
    }
    .awarded{
      margin:6px 0 0;
      font-size:.85rem;
      color:#4b5563;
    }
    .name{
      margin:4px 0 2px;
      font-size:1.6rem;
      font-weight:900;
      color:#0f172a;
    }
    .body-text{
      margin:4px auto 0;
      max-width:720px;
      font-size:.9rem;
      color:#374151;
      line-height:1.35;
    }

    .score-row{
      margin-top:10px;
      font-size:.85rem;
      color:#111827;
    }

    .cert-bottom{
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:18px;
      flex-wrap:wrap;
      font-size:.8rem;
      color:#111827;
    }

    .sign-block{
      flex:1 1 40%;
    }
    .sign-line{
      margin-top:6px;
      border-bottom:1px solid #111827;
    }
    .sign-name{
      margin-top:4px;
      font-weight:800;
      font-size:.9rem;
    }
    .sign-role{
      margin-top:2px;
      color:#4b5563;
      font-size:.78rem;
    }
    .signature-img{
      margin-top:4px;
      height:40px;
    }

    .meta-block{
      flex:1 1 40%;
      text-align:right;
    }
    .cert-id-pill{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      border:1px dashed #d4af37;
      background:rgba(250,250,249,.8);
      font-family:"SF Mono","Menlo",monospace;
      font-size:.78rem;
      margin-top:4px;
    }

    .qr-row{
      margin-top:6px;
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:10px;
    }
    .qr-row img{
      width:70px;
      height:70px;
      border-radius:10px;
      border:1px solid rgba(15,23,42,.12);
      background:#fff;
    }
    .qr-row span{
      font-size:.75rem;
      color:#4b5563;
      max-width:180px;
    }

    .verify-link{
      margin-top:6px;
      font-size:.78rem;
    }
    .verify-link a{
      text-decoration:underline;
      color:#0f766e;
      font-weight:600;
    }

    .btn-row{
      margin-top:10px;
      text-align:center;
    }
    .btn-primary{
      display:inline-block;
      padding:8px 16px;
      border-radius:999px;
      border:none;
      background:#0f766e;
      color:#fff;
      font-size:.85rem;
      font-weight:600;
      cursor:pointer;
    }

    @media (max-width:900px){
      .cert{padding:16px 18px;}
      .cert-main{padding-inline:6px;}
      .cert-wrapper{aspect-ratio:auto;}
    }

    @media print{
      @page { size: A4 landscape; margin:10mm; }
      body{background:#fff;}
      header{display:none;}
      main{padding:0;}
      .btn-row{display:none;}
    }
  </style>

  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
  <script>
    (function(){
      try { window.plausible && window.plausible('CertificateViewed'); } catch(e){}
    })();
  </script>
</head>
<body>
<header>ðŸ§  SpeakOut MindCheck Nigeria</header>

<main>
  <div class="cert-wrapper">
    <div class="cert">
      <div class="cert-inner">
        <!-- Top (logo + initiative text) -->
        <div class="cert-top">
          <div class="cert-logo">
            <img src="icons/logo.png" alt="SpeakOut MindCheck Logo">
          </div>
          <div class="cert-title-block">
            <h1>SpeakOut MindCheck Nigeria</h1>
            <p>
              School & community mental-health screening initiative aligning with WHO
              community-based mental health action and Nigeriaâ€™s national mental-health priorities.
            </p>
          </div>
        </div>

        <!-- Main body -->
        <div class="cert-main">
          <div class="headline">CERTIFICATE OF VOLUNTEER TRAINING</div>
          <p class="subhead">
            This certifies that the volunteer named below has successfully completed MindCheckâ€™s
            core training in safe listening, red-flag triage, ethical referral, privacy-first logging,
            cultural sensitivity, and volunteer self-care.
          </p>

          <p class="awarded">Awarded to</p>
          <p id="cName" class="name">Volunteer Name</p>

          <p class="body-text">
            By completing the SpeakOut MindCheck Volunteer Training and achieving the required pass mark,
            this volunteer has demonstrated the ability to listen respectfully, recognize and escalate
            emergencies without delay, protect privacy using minimum-necessary notes, and connect
            help-seekers to appropriate services and follow-up support in line with WHO-style community
            mental-health action and Nigeriaâ€™s National Mental Health Policy.
          </p>

          <p class="score-row">
            <b>Score:</b> <span id="cScore">â€”</span>%&nbsp;â€¢&nbsp;
            <b>Date:</b> <span id="cDate">â€”</span>
          </p>
        </div>

        <!-- Bottom row: signature + meta/QR -->
        <div class="cert-bottom">
          <div class="sign-block">
            <img class="signature-img" src="icons/signature.png" alt="Signature of Offorka Jerry">
            <div class="sign-line"></div>
            <div class="sign-name">Offorka Jerry</div>
            <div class="sign-role">Founder / Executive Director, SpeakOut Mental Health Outreach</div>
          </div>

          <div class="meta-block">
            <div><b>Certificate ID</b></div>
            <div id="certId" class="cert-id-pill">ISSUINGâ€¦</div>

            <div class="qr-row">
              <img id="qrImg" alt="Certificate QR Code">
              <span>
                Scan to confirm this certificate directly with SpeakOut MindCheckâ€™s verification service.
              </span>
            </div>

            <div class="verify-link">
              To confirm authenticity, please
              <a id="verifyLink" href="verify.html" target="_blank" rel="noopener">verify here</a>.
            </div>
          </div>
        </div>

        <div class="btn-row no-print">
          <button class="btn-primary" onclick="window.print()">Download / Print PDF</button>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  // ====== CONFIG (front-end) ======
  const SCRIPT_URL   = 'https://script.google.com/macros/s/AKfycbxmkC25_qQhxydDmRjjZa_efL-wQwGYysAIIxJ3YkIavJqLr5XVsNHv9okO2d3Epm4vfA/exec'; // <-- replace with your Apps Script web app URL
  const AUTH_TOKEN   = 'speakout123';
  const VERIFY_PAGE  = 'https://speakoutmentalhealth.github.io/MindCheck/verify.html';

  // Parse query params
  const params = new URLSearchParams(location.search);
  const nameQ  = params.get('name') || 'Volunteer';
  const scoreQ = params.get('score') || '100';
  const dateQ  = params.get('date');

  document.getElementById('cName').textContent  = nameQ;
  document.getElementById('cScore').textContent = scoreQ;
  const dt = dateQ ? new Date(decodeURIComponent(dateQ)) : new Date();
  document.getElementById('cDate').textContent  = dt.toLocaleDateString();

  // Generate a stable-ish certificate ID for this issue (front end)
  function generateCertId() {
    const base = Date.now().toString(36).toUpperCase();
    const rand = Math.floor(Math.random()*1e6).toString(36).toUpperCase();
    return 'MC-' + base + '-' + rand;
  }

  const certIdEl = document.getElementById('certId');
  const qrImgEl  = document.getElementById('qrImg');
  const verifyLinkEl = document.getElementById('verifyLink');

  let certId = params.get('cid');
  if (!certId) {
    certId = generateCertId();
  }

  certIdEl.textContent = certId;

  // Build QR code URL pointing to verify.html with this cert ID
  const verifyUrl = VERIFY_PAGE + '?id=' + encodeURIComponent(certId);
  verifyLinkEl.href = verifyUrl;

  // Simple QR using Google Charts API (lightweight)
  const qrSrc =
    'https://chart.googleapis.com/chart?cht=qr&chs=160x160&chl=' +
    encodeURIComponent(verifyUrl);
  qrImgEl.src = qrSrc;

  // Register certificate with backend
  async function registerCertificate() {
    try {
      const body = {
        auth: AUTH_TOKEN,
        type: 'certificate_issue',
        cert_id: certId,
        name: nameQ,
        score: scoreQ,
        date: dt.toISOString(),
        meta: 'program=MindCheck; country=Nigeria'
      };
      const res = await fetch(SCRIPT_URL + '?auth=' + encodeURIComponent(AUTH_TOKEN), {
        method: 'POST',
        headers: { 'Content-Type':'text/plain;charset=utf-8' },
        body: JSON.stringify(body)
      });
      const data = await res.json().catch(()=>({}));
      if (data && data.ok) {
        certIdEl.textContent = data.cert_id || certId;
      } else {
        certIdEl.textContent = 'UNREGISTERED';
      }
    } catch (e) {
      console.error(e);
      certIdEl.textContent = 'UNREGISTERED';
    }
  }

  registerCertificate();
</script>
</body>
</html>

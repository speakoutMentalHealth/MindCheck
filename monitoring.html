<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck ‚Äî Monitoring</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#22c55e"/>
  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
  <style>
    .card{background:#fff;border:1px solid #e8eef5;border-radius:14px;padding:14px;margin:12px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
    label{font-weight:700}
    input[type="number"],input[type="text"],input[type="week"]{width:100%;padding:10px;border:1px solid #e8eef5;border-radius:10px}
    table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;border-radius:12px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  </style>
  <script>
    // Page view event
    (function(){ try{ window.plausible && window.plausible('MonitoringViewed'); }catch(e){} })();
  </script>
</head>
<body>
  <header>üß† SpeakOut MindCheck Nigeria</header>
  <main>
    <h2>Weekly Monitoring (WHO-style)</h2>
    <div class="card">
      <p>Submit weekly totals by city/LGA. Keep personal data out‚Äîaggregates only.</p>
      <div class="grid">
        <div><label>Week</label><input id="mWeek" type="week" required/></div>
        <div><label>City / LGA</label><input id="mSite" type="text" placeholder="e.g., Abuja / AMAC" required/></div>
        <div><label>Contacts</label><input id="mContacts" type="number" min="0" value="0"/></div>
        <div><label>% Screened</label><input id="mPctScreened" type="number" min="0" max="100" value="0"/></div>
        <div><label>Red-flags</label><input id="mRedFlags" type="number" min="0" value="0"/></div>
        <div><label>Referrals</label><input id="mReferrals" type="number" min="0" value="0"/></div>
        <div><label>Follow-ups</label><input id="mFollowUps" type="number" min="0" value="0"/></div>
        <div><label>Volunteer Hours</label><input id="mHours" type="number" min="0" step="0.5" value="0"/></div>
      </div>
      <div class="toolbar">
        <button class="btn btn-primary" id="mSubmit">Submit Week</button>
        <button class="btn btn-ghost" id="mExport">Export CSV</button>
        <a class="btn btn-ghost" href="index.html">‚Üê Home</a>
      </div>
      <p class="muted" id="mStatus"></p>
    </div>

    <div class="card">
      <h3>Submitted Weeks</h3>
      <table id="mTable">
        <thead>
          <tr><th>Week</th><th>City/LGA</th><th>Contacts</th><th>% Screened</th><th>Red-flags</th><th>Referrals</th><th>Follow-ups</th><th>Hours</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <footer>
    üîí <a href="privacy.html">Privacy</a> ‚Ä¢
    üìÑ <a href="terms.html">Terms</a> ‚Ä¢
    üè• <a href="resources.html">Clinics & Resources</a> ‚Ä¢
    ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
  </footer>

  <script>
    const KEY_MON='mc_monitoring_rows';
    const getJSON=(k,f)=>{try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(f))}catch(e){return f}};
    const setJSON=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

    const rowsBody=document.querySelector('#mTable tbody');
    function render(){
      const rows=getJSON(KEY_MON,[]);
      rowsBody.innerHTML=rows.map(r=>`
        <tr>
          <td>${r.week}</td><td>${r.site}</td><td>${r.contacts}</td>
          <td>${r.pct_screened}%</td><td>${r.red}</td><td>${r.ref}</td><td>${r.follow}</td><td>${r.hours}</td>
        </tr>`).join('');
    }
    render();

    document.getElementById('mSubmit').onclick=async ()=>{
      const week=document.getElementById('mWeek').value;
      const site=document.getElementById('mSite').value.trim();
      if(!week||!site){ alert('Select week and site'); return; }
      const row={
        week, site,
        contacts: +document.getElementById('mContacts').value||0,
        pct_screened: +document.getElementById('mPctScreened').value||0,
        red: +document.getElementById('mRedFlags').value||0,
        ref: +document.getElementById('mReferrals').value||0,
        follow: +document.getElementById('mFollowUps').value||0,
        hours: +document.getElementById('mHours').value||0,
        ts: new Date().toISOString()
      };
      const all=getJSON(KEY_MON,[]); all.push(row); setJSON(KEY_MON,all);
      render();
      document.getElementById('mStatus').textContent='Saved locally. Syncing‚Ä¶';

      // Optional: sync to your Google Apps Script (replace with your script URL)
      try{
        await fetch('https://script.google.com/macros/s/AKfycbwbTvjd_4QXeFUmtBZxK1aldG0CtGSEELiP-koRFO-0G-IqctT32syjnSF1-Crl5tQ00A/exec?auth=speakout123', {
          method:'POST',
          headers:{'Content-Type':'text/plain'},
          body: JSON.stringify({type:'weekly_monitor', ...row})
        });
        document.getElementById('mStatus').textContent='Saved & synced.';
      }catch(e){
        document.getElementById('mStatus').textContent='Saved locally (sync failed; will retry when online).';
      }

      try{ window.plausible && window.plausible('MonitoringSubmit',{props:{site}});}catch(e){}
    };

    document.getElementById('mExport').onclick=()=>{
      const rows=getJSON(KEY_MON,[]);
      const csv=['week,site,contacts,pct_screened,red_flags,referrals,followups,hours,ts']
        .concat(rows.map(r=>[r.week,r.site,r.contacts,r.pct_screened,r.red,r.ref,r.follow,r.hours,r.ts].join(',')))
        .join('\n');
      const blob=new Blob([csv],{type:'text/csv'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='mindcheck_weekly_monitoring.csv';
      a.click();
      try{ window.plausible && window.plausible('MonitoringExport'); }catch(e){}
    };
  </script>
</body>
</html>

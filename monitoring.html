<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck ‚Äî Verify Certificate</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#22c55e"/>

  <style>
    .verify-wrap {
      max-width:640px;
      margin:18px auto 32px;
      padding:0 12px;
      text-align:left;
    }
    .card {
      background:#ffffff;
      border:1px solid #e5e7eb;
      border-radius:16px;
      padding:18px;
      box-shadow:0 6px 18px rgba(15,23,42,.06);
    }
    .muted { color:#64748b; }
    .status {
      margin-top:12px;
      font-weight:700;
    }
    .status.ok {
      color:#166534;
    }
    .status.bad {
      color:#b91c1c;
    }
    .pill {
      display:inline-block;
      border-radius:999px;
      padding:4px 10px;
      border:1px solid #e5e7eb;
      font-size:.85rem;
      margin-top:6px;
    }
    .uid {
      font-family:ui-monospace,Consolas,monospace;
      background:#f9fafb;
      padding:2px 6px;
      border-radius:6px;
    }
    .toolbar {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:12px;
      justify-content:flex-start;
    }
  </style>

  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
  <script>
    (function(){
      try { window.plausible && window.plausible('VerifyViewed'); } catch(e){}
    })();
  </script>
</head>
<body>
  <header>üß† SpeakOut MindCheck Nigeria</header>

  <main class="verify-wrap">
    <h2>Verify Volunteer Certificate</h2>
    <p class="muted">
      Enter the <b>Certificate ID</b> exactly as it appears on the document
      (for example: <span class="uid">MC-CERT-20251113-ABCD</span>).
      The system will check if it was issued by SpeakOut MindCheck.
    </p>

    <div class="card">
      <label for="certInput" style="font-weight:700;">Certificate ID</label>
      <input id="certInput" class="btn btn-ghost" style="width:100%;text-align:left;margin-top:4px;"
             placeholder="Type or paste certificate ID here"/>

      <div class="toolbar">
        <button id="checkBtn" class="btn btn-primary" type="button">Verify</button>
        <button id="clearBtn" class="btn btn-ghost" type="button">Clear</button>
        <a href="certificate.html" class="btn btn-ghost">Open Sample Certificate</a>
      </div>

      <div id="status" class="status"></div>

      <div id="details" class="muted" style="margin-top:8px;display:none;"></div>
    </div>

    <p class="muted" style="margin-top:10px;">
      This verification checks against MindCheck‚Äôs internal certificate register stored securely via Google Workspace.
    </p>
  </main>

  <footer style="margin-top:10px;">
    üîí <a href="privacy.html">Privacy</a> ‚Ä¢
    üìÑ <a href="terms.html">Terms</a> ‚Ä¢
    üè• <a href="resources.html">Clinics & Resources</a> ‚Ä¢
    ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
  </footer>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwbTvjd_4QXeFUmtBZxK1aldG0CtGSEELiP-koRFO-0G-IqctT32syjnSF1-Crl5tQ00A/exec';

    const inputEl = document.getElementById('certInput');
    const statusEl = document.getElementById('status');
    const detailsEl = document.getElementById('details');
    const checkBtn = document.getElementById('checkBtn');
    const clearBtn = document.getElementById('clearBtn');

    function setStatus(msg, ok, extra) {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + (ok ? 'ok' : 'bad');
      if (extra) {
        detailsEl.style.display = 'block';
        detailsEl.innerHTML = extra;
      } else {
        detailsEl.style.display = 'none';
        detailsEl.textContent = '';
      }
    }

    function looksLikeId(id) {
      // Simple front-end format check: must start with "MC-CERT-" and be a reasonable length
      return /^MC-CERT-\d{8}-[A-Z0-9]{4}$/i.test(id.trim());
    }

    async function verify() {
      const raw = (inputEl.value || '').trim();
      if (!raw) {
        setStatus('Please type a Certificate ID to verify.', false);
        return;
      }

      // Front-end format hint
      if (!looksLikeId(raw)) {
        setStatus('‚ùå The format looks unusual. Please check the ID and try again.', false);
        return;
      }

      setStatus('Checking certificate‚Ä¶', true);
      try {
        window.plausible && window.plausible('VerifyAttempt', { props:{ id: raw }});
      } catch(e){}

      try {
        const url = `${GAS_URL}?auth=speakout123&type=verify_cert&id=${encodeURIComponent(raw)}`;
        const res = await fetch(url, { method:'GET' });
        const txt = await res.text();
        let data;
        try { data = JSON.parse(txt); }
        catch { data = { ok:false, reason:'parse_error', raw:txt }; }

        if (data.ok) {
          const extra = `
            <div class="pill">Issued to: <b>${(data.name || '‚Äî')}</b></div><br/>
            <span><b>Score:</b> ${data.score || '‚Äî'}%</span><br/>
            <span><b>Date:</b> ${data.date || '‚Äî'}</span>
          `;
          setStatus('‚úÖ Valid certificate ‚Äî recognised by SpeakOut MindCheck.', true, extra);
        } else {
          let reason = 'not recognised';
          if (data.reason === 'not_found') reason = 'not found in the register';
          if (data.reason === 'no_sheet') reason = 'register not configured';
          if (data.reason === 'no_data') reason = 'no certificates stored yet';
          setStatus(`‚ùå Certificate ${reason}.`, false);
        }
      } catch (err) {
        console.warn('Verify failed:', err);
        setStatus('‚ùå Could not reach verification service. Please try again later.', false);
      }
    }

    checkBtn.addEventListener('click', verify);
    clearBtn.addEventListener('click', () => {
      inputEl.value = '';
      statusEl.textContent = '';
      statusEl.className = 'status';
      detailsEl.style.display = 'none';
      detailsEl.textContent = '';
    });

    // Auto-fill from ?id= in URL if present
    const urlParams = new URLSearchParams(location.search);
    const fromUrl = urlParams.get('id');
    if (fromUrl) {
      inputEl.value = fromUrl;
      verify();
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SpeakOut MindCheck ‚Äî Verify Certificate</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#22c55e"/>

  <style>
    .verify-card {
      max-width:640px;
      margin:18px auto;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:14px;
      padding:16px;
      text-align:left;
      box-shadow:0 8px 24px rgba(15,23,42,.06);
    }
    .muted { color:#64748b; }
    .status-ok { color:#166534; font-weight:700; }
    .status-bad { color:#b91c1c; font-weight:700; }
    .status-warn { color:#854d0e; font-weight:700; }
    .field { margin:10px 0; }
    input[type=text] {
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      font-size:1rem;
      box-sizing:border-box;
    }
  </style>

  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
</head>
<body>
  <header>üß† SpeakOut MindCheck Nigeria</header>

  <main>
    <div class="verify-card">
      <h2>Verify Certificate</h2>
      <p class="muted">
        Enter the <b>Certificate ID</b> shown on the document (format: <code>MCV-XXXXXXXX</code>).
        This tool checks if the ID matches an official SpeakOut MindCheck training record.
      </p>

      <div class="field">
        <label for="certId" class="muted" style="font-weight:600;">Certificate ID</label>
        <input id="certId" type="text" placeholder="e.g. MCV-1A2B3C4D"/>
      </div>

      <div class="toolbar" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
        <button id="checkBtn" class="btn btn-primary" type="button">Verify</button>
        <button id="clearBtn" class="btn btn-ghost" type="button">Clear</button>
        <a class="btn btn-ghost" href="training-hub.html">‚Üê Back to Training Hub</a>
      </div>

      <div id="statusBox" style="margin-top:14px;"></div>
    </div>
  </main>

  <footer style="margin-top:20px;">
    üîí <a href="privacy.html">Privacy</a> ‚Ä¢
    üìÑ <a href="terms.html">Terms</a> ‚Ä¢
    üè• <a href="resources.html">Clinics & Resources</a> ‚Ä¢
    ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
  </footer>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbwbTvjd_4QXeFUmtBZxK1aldG0CtGSEELiP-koRFO-0G-IqctT32syjnSF1-Crl5tQ00A/exec';
    const input = document.getElementById('certId');
    const statusBox = document.getElementById('statusBox');
    const checkBtn = document.getElementById('checkBtn');
    const clearBtn = document.getElementById('clearBtn');

    function showStatus(html, cls) {
      statusBox.innerHTML = `<div class="${cls}">${html}</div>`;
    }

    function normalizeId(raw) {
      return raw.trim().toUpperCase();
    }

    function isFormatOk(id) {
      // MCV- + 8 hex characters
      return /^MCV-[0-9A-F]{8}$/.test(id);
    }

    async function verify() {
      const raw = input.value;
      const id = normalizeId(raw);
      if (!id) {
        showStatus('Please enter a Certificate ID.', 'status-warn');
        return;
      }

      if (!isFormatOk(id)) {
        showStatus('Format not recognized. Expected something like <code>MCV-1A2B3C4D</code>.', 'status-bad');
        return;
      }

      // Front-end format OK
      showStatus('Checking our records‚Ä¶', 'muted');

      try {
        const url = `${API_URL}?auth=speakout123&type=verify_cert&id=${encodeURIComponent(id)}`;
        const res = await fetch(url);
        const data = await res.json().catch(() => ({}));

        if (data.ok) {
          const name = data.name || '‚Äî';
          const score = data.score != null ? data.score : '‚Äî';
          const date = data.date ? new Date(data.date).toLocaleDateString() : '‚Äî';
          showStatus(`
            ‚úÖ <span class="status-ok">Valid SpeakOut MindCheck certificate.</span><br/>
            <b>Certificate ID:</b> ${id}<br/>
            <b>Name:</b> ${name}<br/>
            <b>Score:</b> ${score}%<br/>
            <b>Date issued:</b> ${date}
          `, '');
          try { window.plausible && window.plausible('CertificateVerified', {props:{status:'ok'}}); } catch(e){}
        } else {
          const reason = data.reason || 'not_found';
          showStatus(`
            ‚ùå <span class="status-bad">Not recognized in our official records.</span><br/>
            Please check the ID formatting or contact <a href="mailto:speaaakout@gmail.com">SpeakOut</a> if you believe this is an error.
          `, '');
          try { window.plausible && window.plausible('CertificateVerified', {props:{status:reason}}); } catch(e){}
        }
      } catch (err) {
        console.warn('Verify error', err);
        showStatus('Network error while verifying. Please try again.', 'status-bad');
      }
    }

    checkBtn.addEventListener('click', verify);
    clearBtn.addEventListener('click', () => {
      input.value = '';
      statusBox.innerHTML = '';
    });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        verify();
      }
    });

    // Plausible page view
    try { window.plausible && window.plausible('VerifyViewed'); } catch(e){}
  </script>
</body>
</html>

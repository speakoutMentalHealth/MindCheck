<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Verify SpeakOut MindCheck Certificate</title>
  <link rel="icon" href="favicon.png"/>
  <link rel="stylesheet" href="mc-theme.css"/>
  <meta name="theme-color" content="#0f766e"/>

  <style>
    main{max-width:640px;margin:20px auto;padding:0 12px;text-align:left;}
    h2{margin-bottom:6px;}
    .muted{color:#52606d;font-size:.9rem;}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px;margin-top:12px;}
    .field{margin-top:8px;}
    .field label{display:block;font-weight:600;font-size:.9rem;margin-bottom:4px;}
    .field input{
      width:100%;padding:8px 10px;border-radius:999px;border:1px solid #d1d5db;
      font-size:.9rem;
    }
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    .btn-primary{border:none;border-radius:999px;background:#0f766e;color:#fff;
      font-size:.9rem;font-weight:600;padding:8px 16px;cursor:pointer;}
    .btn-ghost{border-radius:999px;border:1px solid #d1d5db;background:#fff;
      font-size:.85rem;padding:6px 14px;cursor:pointer;}
    .status{margin-top:10px;font-size:.9rem;font-weight:600;}
    .ok{color:#166534;}
    .bad{color:#7f1d1d;}
    .detail{margin-top:4px;font-size:.85rem;}
    .pill{display:inline-block;margin-top:6px;padding:4px 10px;border-radius:999px;
      font-family:"SF Mono","Menlo",monospace;font-size:.78rem;border:1px dashed #d4af37;}
  </style>

  <script defer data-domain="speakoutmentalhealth.github.io" src="https://plausible.io/js/script.js"></script>
  <script>
    (function(){
      try{ window.plausible && window.plausible('VerifyPageViewed'); }catch(e){}
    })();
  </script>
</head>
<body>
<header>üß† SpeakOut MindCheck Nigeria</header>

<main>
  <h2>Verify a Volunteer Training Certificate</h2>
  <p class="muted">
    Enter the <b>Certificate ID</b> printed on the SpeakOut MindCheck certificate to confirm that it
    was issued by SpeakOut and is recorded in our training register.
  </p>

  <section class="card">
    <div class="field">
      <label for="certInput">Certificate ID</label>
      <input id="certInput" placeholder="e.g. MC-ABC123-XYZ9" autocomplete="off"/>
    </div>

    <div class="toolbar">
      <button id="verifyBtn" class="btn-primary" type="button">Verify Certificate</button>
      <button id="clearBtn" class="btn-ghost" type="button">Clear</button>
      <a href="certificate.html" class="btn-ghost">View sample certificate</a>
    </div>

    <div id="statusBox" class="status" style="display:none"></div>
    <div id="detailBox" class="detail" style="display:none"></div>
  </section>

  <p class="muted" style="margin-top:16px;">
    For ministries, donors and institutional partners, you may cite SpeakOut MindCheck Nigeria as a
    school and community mental-health screening initiative aligned with WHO community-based care
    guidance and Nigeria‚Äôs National Mental Health Policy.
  </p>
</main>

<footer>
  üîí <a href="privacy.html">Privacy</a> ‚Ä¢
  üìÑ <a href="terms.html">Terms</a> ‚Ä¢
  ‚úâÔ∏è <a href="mailto:speaaakout@gmail.com">speaaakout@gmail.com</a>
</footer>

<script>
  const SCRIPT_URL = 'YOUR_WEBAPP_URL_HERE'; // same as in certificate.html
  const AUTH_TOKEN = 'speakout123';

  const input  = document.getElementById('certInput');
  const btn    = document.getElementById('verifyBtn');
  const clearB = document.getElementById('clearBtn');
  const status = document.getElementById('statusBox');
  const detail = document.getElementById('detailBox');

  function setStatus(ok, msg, extra){
    status.style.display='block';
    detail.style.display= extra ? 'block' : 'none';
    status.className = 'status ' + (ok?'ok':'bad');
    status.textContent = msg;
    detail.innerHTML = extra || '';
  }

  async function doVerify(){
    const id = (input.value || '').trim();
    if(!id){
      setStatus(false, 'Please enter a Certificate ID.');
      return;
    }
    setStatus(false, 'Checking‚Ä¶ please wait.');
    try{
      const url = SCRIPT_URL +
        '?type=verify_cert&auth=' + encodeURIComponent(AUTH_TOKEN) +
        '&id=' + encodeURIComponent(id);

      const res  = await fetch(url);
      const data = await res.json().catch(()=>({}));

      if(data && data.ok){
        setStatus(
          true,
          '‚úÖ Valid certificate',
          `
            <div>Certificate ID: <span class="pill">${data.cert_id}</span></div>
            <div>Issued to: <b>${data.name || '-'}</b></div>
            <div>Score: <b>${data.score || '-'}</b>%</div>
            <div>Issue date (ISO): <b>${data.date || '-'}</b></div>
          `
        );
        try{ window.plausible && window.plausible('CertificateVerifyOK'); }catch(e){}
      } else {
        setStatus(false, '‚ùå Not recognised', 'No matching certificate was found in the register.');
        try{ window.plausible && window.plausible('CertificateVerifyFail'); }catch(e){}
      }
    }catch(e){
      console.error(e);
      setStatus(false, '‚ùå Verification error', 'Unable to contact verification service right now.');
    }
  }

  btn.addEventListener('click', doVerify);
  clearB.addEventListener('click', ()=>{
    input.value='';
    status.style.display='none';
    detail.style.display='none';
  });

  // If verify.html was opened via QR with ?id=...
  const params = new URLSearchParams(location.search);
  const preId  = params.get('id');
  if(preId){
    input.value = preId;
    doVerify();
  }
</script>
</body>
</html>
